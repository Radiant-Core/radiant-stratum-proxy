# ============================================================================
# Radiant Stratum Proxy - IceRiver RX0 ASIC Configuration
# ============================================================================
# Optimized for IceRiver RX0 miners (~300 GH/s per unit)
# Tested with IceRiverMiner firmware v1.1
#
# This configuration reduces share rejection rates to <1% by:
#   - Using job history to prevent "unknown/old job" rejections
#   - Tuning VarDiff for IceRiver's share submission behavior
#   - Setting a 120s job roll interval to reduce stale shares
#
# Copy this file: cp .env.example.iceriver .env
# Then edit .env to set your RPC password and other settings
# ============================================================================

# Radiant Node Configuration
RXD_RPC_USER=radiant_user
RXD_RPC_PASS=change_this_secure_password
RXD_RPC_PORT=7332
RXD_P2P_PORT=7333

# Radiant Build Configuration (Docker only)
RADIANT_VERSION=main

# Network Selection
NETWORK=mainnet
TESTNET=false

# Stratum Proxy Configuration
STRATUM_PORT=54321
PROXY_SIGNATURE=/radiant-stratum-proxy/

# Mining Optimization
USE_EASIER_TARGET=true

# Job Roll Interval (seconds)
# Higher values = fewer "unknown/old job" rejections
# IceRiver miners benefit from longer intervals since they submit shares
# for recently-expired jobs. The proxy keeps a history of the last 10 jobs
# so shares for older jobs are still validated correctly.
NTIME_ROLL=120

# === Static Share Difficulty (fallback when VarDiff is disabled) ===
# 512 is a good starting point for IceRiver RX0 (~300 GH/s)
STATIC_SHARE_DIFFICULTY=512.0

# === Variable Difficulty (VarDiff) Settings ===
# RECOMMENDED for IceRiver - auto-adjusts difficulty per miner
ENABLE_VARDIFF=true

# Target 20 seconds between shares
# This balances hashrate accuracy with low proxy overhead
VARDIFF_TARGET_SHARE_TIME=20.0

# Difficulty bounds tuned for IceRiver RX0
# - Min 256: low enough to accept shares during difficulty adjustment
# - Max 16000: high enough for multiple high-hashrate units
# - Start 512: conservative start that works well with IceRiver firmware
VARDIFF_MIN_DIFFICULTY=256.0
VARDIFF_MAX_DIFFICULTY=16000.0
VARDIFF_START_DIFFICULTY=512.0

# Retargeting: wait for 20 shares or 180 seconds before adjusting
# Less aggressive retargeting provides smoother difficulty convergence
VARDIFF_RETARGET_SHARES=20
VARDIFF_RETARGET_TIME=180.0

# Step sizes
# UP_STEP=2.0: double difficulty when shares come too fast
# DOWN_STEP=0.8: reduce by 20% when shares are too slow (gentler than halving)
VARDIFF_UP_STEP=2.0
VARDIFF_DOWN_STEP=0.8

# EMA smoothing factor (0.3 = moderate smoothing)
VARDIFF_EMA_ALPHA=0.3

# Inactivity handling
# IceRiver miners are typically always-on, so use longer inactivity thresholds
VARDIFF_INACTIVITY_LOWER=120.0
VARDIFF_INACTIVITY_MULTIPLES=6.0
VARDIFF_INACTIVITY_DROP_FACTOR=0.5

# Persist difficulty between proxy restarts
# Miners reconnecting within WARM_START_MINUTES get their previous difficulty
VARDIFF_STATE_PATH=data/vardiff_state.json
VARDIFF_WARM_START_MINUTES=60
VARDIFF_CHAIN_HEADROOM=0.9

# ZMQ Configuration (instant new block notifications)
ENABLE_ZMQ=true
RXD_ZMQ_ENDPOINT=tcp://radiant:29332
RXD_ZMQ_PORT=29332
RXD_ZMQ_RAW_PORT=29333

# Logging (INFO recommended for production, DEBUG for troubleshooting)
LOG_LEVEL=INFO
SHOW_JOBS=false

# Notifications (uncomment and configure to receive block/miner alerts)
#DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/your_webhook_id/your_webhook_token
#TELEGRAM_BOT_TOKEN=your_bot_token
#TELEGRAM_CHAT_ID=your_chat_id

# Web Dashboard (recommended - shows miners, hashrate, peers, blocks)
ENABLE_DASHBOARD=true
DASHBOARD_PORT=8080
ENABLE_DATABASE=true
